<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minecraft Mobile - Quebrar Blocos</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        /* UI de Jogo */
        #game-ui { display: none; }
        
        /* MIRA CENTRAL (CROSSHAIR) */
        #crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            z-index: 100;
            pointer-events: none;
        }
        #crosshair::before, #crosshair::after {
            content: '';
            position: absolute;
            background: white;
            box-shadow: 0 0 2px black;
        }
        #crosshair::before { top: 50%; left: 0; width: 100%; height: 2px; transform: translateY(-50%); }
        #crosshair::after { left: 50%; top: 0; height: 100%; width: 2px; transform: translateX(-50%); }

        /* BOTÃO DE INTERAÇÃO (QUEBRAR) */
        .action-btn {
            position: fixed;
            bottom: 30px;
            right: 20px;
            width: 80px;
            height: 80px;
            background: rgba(255, 0, 0, 0.4);
            border: 3px solid white;
            border-radius: 50%;
            color: white;
            font-weight: bold;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: none;
        }

        /* Estilos base (Menu, Joysticks, Hotbar mantidos) */
        #menu-inicial { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 5000; gap: 20px; }
        .menu-title { color: white; font-family: sans-serif; font-size: 30px; text-shadow: 2px 2px #000; }
        .menu-btn { width: 200px; padding: 12px; background: #4a4a4a; border: 2px solid #000; color: #fff; font-weight: bold; text-align: center; }
        .joystick-container { position: fixed; bottom: 30px; left: 20px; z-index: 999; display: grid; grid-template-columns: repeat(3, 60px); gap: 8px; }
        button.move-btn { width: 60px; height: 60px; background: rgba(0,0,0,0.5); border: 2px solid #ccc; color: white; border-radius: 12px; }
        .hotbar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 4px; background: rgba(0, 0, 0, 0.5); padding: 5px; z-index: 1000; }
        .slot { width: 40px; height: 40px; background: rgba(255, 255, 255, 0.1); border: 2px solid #555; display: flex; justify-content: center; align-items: center; color: white; }
        .slot.active { border-color: #ffff00; }
    </style>
</head>
<body>

    <div id="crosshair"></div>

    <div id="menu-inicial">
        <div class="menu-title">MINECRAFT WEB</div>
        <div class="menu-btn" onclick="startGame()">JOGAR</div>
    </div>

    <div id="game-ui">
        <div class="action-btn" id="break-btn">QUEBRAR</div>
        
        <div class="hotbar"><div class="slot active">1</div><div class="slot">2</div><div class="slot">3</div></div>
        
        <div class="joystick-container">
            <div style="grid-column: 2"><button class="move-btn" id="btnUp">W</button></div>
            <button class="move-btn" id="btnLeft" style="grid-row: 2; grid-column: 1">A</button>
            <button class="move-btn" id="btnDown" style="grid-row: 2; grid-column: 2">S</button>
            <button class="move-btn" id="btnRight" style="grid-row: 2; grid-column: 3">D</button>
        </div>
    </div>

    <a-scene>
        <a-assets>
            <canvas id="tex-grama" width="64" height="64"></canvas>
            <canvas id="tex-pedra" width="64" height="64"></canvas>
        </a-assets>

        <a-sky color="#73C2FB"></a-sky>

        <a-box class="interactable" position="0 -1 0" width="100" height="2" depth="100" 
               material="src: #tex-grama; repeat: 100 2; roughness: 1"></a-box>
        
        <a-box class="interactable" position="0 -11 0" width="100" height="18" depth="100" 
               material="src: #tex-pedra; repeat: 100 18; roughness: 1"></a-box>

        <a-box class="interactable" position="2 0.5 -5" color="#567d46"></a-box>
        <a-box class="interactable" position="-2 0.5 -3" color="#888888"></a-box>

        <a-entity id="rig" position="0 0 0">
            <a-entity id="camera" camera position="0 1.6 0" look-controls="enabled: false">
                <a-entity id="raycaster" raycaster="objects: .interactable; far: 5"></a-entity>
            </a-entity>
        </a-entity>

        <a-light type="ambient" color="#FFF"></a-light>
    </a-scene>

    <script>
        // Gerar Texturas
        function createTex(id, color) {
            const ctx = document.getElementById(id).getContext('2d');
            ctx.fillStyle = color; ctx.fillRect(0,0,64,64);
            ctx.strokeStyle = 'rgba(0,0,0,0.2)'; ctx.lineWidth = 4; ctx.strokeRect(0,0,64,64);
        }
        createTex('tex-grama', '#567d46'); createTex('tex-pedra', '#888888');

        // Lógica de Quebrar
        const raycaster = document.querySelector('#raycaster');
        const breakBtn = document.querySelector('#break-btn');

        breakBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const intersection = raycaster.components.raycaster.getIntersection(document.querySelector('.interactable'));
            
            if (intersection) {
                const target = intersection.object.el;
                // Animação simples de "sumir" ao quebrar
                target.setAttribute('visible', 'false');
                // Remove do mundo
                setTimeout(() => target.parentNode.removeChild(target), 100);
            }
        });

        // Funções de Interface
        function startGame() {
            document.getElementById('menu-inicial').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';
        }

        // --- SISTEMA DE MOVIMENTO E TOQUE (MANTIDO) ---
        const rig = document.querySelector('#rig'), camera = document.querySelector('#camera');
        let moveSpeed = 0.12, lookSens = 0.15, pitch = 0, yaw = 0;
        const keys = { up: false, down: false, left: false, right: false };
        let isTouching = false, lastX, lastY;

        window.addEventListener('touchstart', e => { 
            if(e.target.tagName !== 'BUTTON' && e.target.id !== 'break-btn'){ 
                isTouching = true; lastX = e.touches[0].screenX; lastY = e.touches[0].screenY; 
            }
        });
        window.addEventListener('touchmove', e => {
            if(!isTouching) return;
            yaw -= (e.touches[0].screenX - lastX) * lookSens;
            pitch = Math.max(-80, Math.min(80, pitch - (e.touches[0].screenY - lastY) * lookSens));
            lastX = e.touches[0].screenX; lastY = e.touches[0].screenY;
            camera.setAttribute('rotation', `${pitch} ${yaw} 0`);
        });
        window.addEventListener('touchend', () => isTouching = false);

        function bind(id, k) { 
            document.getElementById(id).addEventListener('touchstart', e => {e.preventDefault(); keys[k] = true;});
            document.getElementById(id).addEventListener('touchend', () => keys[k] = false);
        }
        bind('btnUp','up'); bind('btnDown','down'); bind('btnLeft','left'); bind('btnRight','right');

        function update() {
            if(keys.up || keys.down || keys.left || keys.right) {
                let angle = yaw * (Math.PI / 180);
                let pos = rig.getAttribute('position');
                if(keys.up){ pos.x -= Math.sin(angle)*moveSpeed; pos.z -= Math.cos(angle)*moveSpeed; }
                if(keys.down){ pos.x += Math.sin(angle)*moveSpeed; pos.z += Math.cos(angle)*moveSpeed; }
                if(keys.left){ pos.x -= Math.cos(angle)*moveSpeed; pos.z += Math.sin(angle)*moveSpeed; }
                if(keys.right){ pos.x += Math.cos(angle)*moveSpeed; pos.z -= Math.sin(angle)*moveSpeed; }
                rig.setAttribute('position', pos);
            }
            requestAnimationFrame(update);
        }
        update();
    </script>
</body>
</html>
