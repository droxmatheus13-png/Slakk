<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FNAF: Michael's Three Nights</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Press Start 2P', cursive, monospace; background-color: #000; }
        canvas { display: block; }

        /* Painel de Objetivos */
        #objective-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #FF0000;
            color: #FF0000;
            font-size: 10px;
            z-index: 20;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }
        #objective-text { color: #fff; margin-top: 10px; display: block; }

        /* Mira (Crosshair) */
        #crosshair {
            position: absolute;
            top: 50%; left: 50%;
            width: 4px; height: 4px;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 15;
        }

        /* Botões */
        #controls {
            position: absolute; bottom: 20px; left: 20px;
            display: grid; grid-template-columns: repeat(3, 60px); grid-gap: 10px; z-index: 10;
        }
        .btn {
            width: 60px; height: 60px; background: rgba(255, 255, 255, 0.1);
            border: 2px solid #888; border-radius: 10px; color: #ccc;
            display: flex; align-items: center; justify-content: center;
        }
        #up { grid-column: 2; } #left { grid-column: 1; } #down { grid-column: 2; } #right { grid-column: 3; }
        
        #blocker {
            position: absolute; width: 100%; height: 100%; background-color: #000;
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000;
        }
        #start-button { padding: 20px 40px; font-size: 1.2em; cursor: pointer; background: #1a1a1a; color: #00FF00; border: 2px solid #00FF00; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>

    <div id="objective-panel">
        OBJETIVO ATUAL:
        <span id="objective-text">Pegue a chave</span>
    </div>

    <div id="crosshair"></div>

    <div id="blocker">
        <h1 style="color:red; margin-bottom: 20px;">FNAF: Michael's Three Nights</h1>
        <button id="start-button">INICIAR NOITE</button>
    </div>
    
    <div id="controls">
        <div id="up" class="btn">W</div>
        <div id="left" class="btn">A</div>
        <div id="down" class="btn">S</div>
        <div id="right" class="btn">D</div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x010103);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const flashlight = new THREE.SpotLight(0xffffff, 20, 30, Math.PI/6, 0.5);
        camera.add(flashlight);
        camera.add(flashlight.target);
        flashlight.target.position.set(0, 0, -1);
        scene.add(camera);

        const terrain = new THREE.Mesh(new THREE.PlaneGeometry(500, 500), new THREE.MeshPhongMaterial({ color: 0x0a0a0a }));
        terrain.rotation.x = -Math.PI / 2;
        scene.add(terrain);

        // --- SISTEMA DE OBJETIVOS ---
        let currentObjective = 1;
        const objectiveLabel = document.getElementById('objective-text');

        // --- OBJETOS ---
        // 1. Casa 1 (Onde está a chave)
        const house1 = new THREE.Group();
        house1.add(new THREE.Mesh(new THREE.BoxGeometry(6, 4, 6), new THREE.MeshPhongMaterial({ color: 0x2b1d12 })));
        const mesa = new THREE.Mesh(new THREE.BoxGeometry(1.5, 0.1, 1), new THREE.MeshPhongMaterial({ color: 0x1a0f0a }));
        mesa.position.set(0, 0.8, 0);
        house1.add(mesa);
        
        // Chave Realista
        const chave = new THREE.Group();
        const kPart = new THREE.Mesh(new THREE.CylinderGeometry(0.02, 0.02, 0.3), new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 1 }));
        kPart.rotation.z = Math.PI/2;
        chave.add(kPart);
        chave.name = "CHAVE"; // Nome para detecção
        chave.position.set(0, 0.9, 0);
        house1.add(chave);
        house1.position.set(10, 0, 10);
        scene.add(house1);

        // 2. Casa dos Fundos (Onde está a bicicleta)
        const house2 = new THREE.Group();
        const walls2 = new THREE.Mesh(new THREE.BoxGeometry(6, 4, 6), new THREE.MeshPhongMaterial({ color: 0x1a1a1a }));
        house2.add(walls2);
        
        // Bicicleta (Geometria simples: 2 rodas e um quadro)
        const bike = new THREE.Group();
        const rodaGeo = new THREE.TorusGeometry(0.4, 0.05, 8, 16);
        const rodaMat = new THREE.MeshBasicMaterial({color: 0x111111});
        const r1 = new THREE.Mesh(rodaGeo, rodaMat); r1.position.x = -0.6;
        const r2 = new THREE.Mesh(rodaGeo, rodaMat); r2.position.x = 0.6;
        const quadro = new THREE.Mesh(new THREE.BoxGeometry(1.2, 0.1, 0.1), new THREE.MeshBasicMaterial({color: 0x880000}));
        quadro.position.y = 0.4;
        bike.add(r1, r2, quadro);
        bike.name = "BICICLETA";
        bike.position.set(0, 0.4, 0);
        house2.add(bike);
        house2.position.set(-15, 0, -20);
        scene.add(house2);

        // --- DETECÇÃO ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2(0, 0); // Centro da tela

        function checkInteractions() {
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(scene.children, true);

            if (intersects.length > 0) {
                const obj = intersects[0].object.parent; // Pegamos o grupo (Chave ou Bike)
                
                if (currentObjective === 1 && obj && obj.name === "CHAVE" && intersects[0].distance < 3) {
                    scene.remove(chave);
                    currentObjective = 2;
                    objectiveLabel.innerText = "Abra a cabana dos fundos e pegue a Bicicleta";
                    objectiveLabel.style.color = "#00FF00";
                }
                
                if (currentObjective === 2 && obj && obj.name === "BICICLETA" && intersects[0].distance < 3) {
                    scene.remove(bike);
                    objectiveLabel.innerText = "VOCÊ SOBREVIVEU À PRIMEIRA NOITE";
                    objectiveLabel.style.color = "#00FFFF";
                }
            }
        }

        // --- CONTROLES E LOOP ---
        const controls = new PointerLockControls(camera, document.body);
        document.getElementById('start-button').onclick = () => controls.lock();
        controls.addEventListener('lock', () => document.getElementById('blocker').style.display = 'none');
        controls.addEventListener('unlock', () => document.getElementById('blocker').style.display = 'flex');

        const keys = { w: false, a: false, s: false, d: false };
        window.onkeydown = (e) => keys[e.key.toLowerCase()] = true;
        window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

        camera.position.set(0, 1.6, 0);

        function animate() {
            requestAnimationFrame(animate);
            if (controls.isLocked) {
                if (keys.w) controls.moveForward(0.1);
                if (keys.s) controls.moveForward(-0.1);
                if (keys.a) controls.moveRight(-0.1);
                if (keys.d) controls.moveRight(0.1);
                checkInteractions();
            }
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
