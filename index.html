<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FNAF: No Safe Place</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; touch-action: none; }
        #menu-inicial, #selecao-dispositivo, #intro-text, #tela-acordar {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100; transition: opacity 0.8s; background: black;
        }
        h1 { color: #8b0000; font-size: 2rem; text-shadow: 0 0 10px #f00; text-align: center; }
        button {
            padding: 15px 30px; font-size: 1rem; background: transparent;
            color: white; border: 1px solid #444; cursor: pointer;
            transition: 0.3s; letter-spacing: 2px; margin: 10px; width: 250px;
        }
        button:hover { background: #8b0000; border-color: #f00; }
        #tela-acordar { display: none; z-index: 300; }
        .btn-acordar { position: absolute; border: 1px solid #8b0000; color: #ff0000; background: black; padding: 15px; cursor: pointer; border-radius: 50%; }
        #fade-overlay { position: absolute; width: 100%; height: 100%; background: black; opacity: 0; pointer-events: none; z-index: 200; }
        
        /* Controles Celular */
        #joystick-area { position: absolute; bottom: 40px; left: 40px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border-radius: 50%; display: none; z-index: 150; }
        #joystick-stick { position: absolute; top: 35px; left: 35px; width: 50px; height: 50px; background: rgba(255,255,255,0.3); border-radius: 50%; }
    </style>
</head>
<body>

    <div id="fade-overlay"></div>

    <div id="menu-inicial">
        <h1>FNAF:<br>NO SAFE PLACE</h1>
        <button onclick="irParaSelecao()">JOGAR</button>
    </div>

    <div id="selecao-dispositivo" style="display: none;">
        <h2 style="color: white;">ONDE VOCÊ ESTÁ JOGANDO?</h2>
        <button onclick="configurarDispositivo('pc')">COMPUTADOR (WASD)</button>
        <button onclick="configurarDispositivo('mobile')">CELULAR (TOUCH)</button>
    </div>

    <div id="intro-text" style="display:none; color:white; font-size:1.2rem;"></div>
    <div id="tela-acordar"></div>
    <div id="joystick-area"><div id="joystick-stick"></div></div>

<script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
            "tween": "https://cdnjs.cloudflare.com/ajax/libs/tween.js/23.1.1/tween.esm.js"
        }
    }
</script>

<script type="module">
    import * as THREE from 'three';
    import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';
    import TWEEN from 'tween';

    let dispositivo = 'pc';
    let moveForward = 0, moveRight = 0;

    // --- SETUP MUNDO ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new PointerLockControls(camera, document.body);

    // Iluminação mais branca/suave para tirar o excesso de vermelho
    const luzQuarto = new THREE.PointLight(0xffffff, 0, 35); 
    luzQuarto.position.set(0, 8, 0);
    scene.add(luzQuarto);
    scene.add(new THREE.AmbientLight(0x404040, 0.1));

    // --- CONSTRUÇÃO (QUARTO E CORREDOR) ---
    const matWall = new THREE.MeshStandardMaterial({ color: 0x221111, side: THREE.BackSide });
    const quarto = new THREE.Mesh(new THREE.BoxGeometry(20, 12, 20), matWall);
    quarto.position.set(0, 6, 0);
    scene.add(quarto);

    const cama = new THREE.Mesh(new THREE.BoxGeometry(6, 2, 10), new THREE.MeshStandardMaterial({color: 0x331a00}));
    cama.position.set(-6, 1, 4);
    scene.add(cama);

    const corredor = new THREE.Mesh(new THREE.BoxGeometry(8, 12, 60), matWall);
    corredor.position.set(0, 6, 40);
    scene.add(corredor);

    // --- FUNÇÕES DE MENU ---
    window.irParaSelecao = () => {
        document.getElementById('menu-inicial').style.display = 'none';
        document.getElementById('selecao-dispositivo').style.display = 'flex';
    };

    window.configurarDispositivo = (tipo) => {
        dispositivo = tipo;
        document.getElementById('selecao-dispositivo').style.display = 'none';
        if(dispositivo === 'mobile') document.getElementById('joystick-area').style.display = 'block';
        animarTexto();
    };

    function animarTexto() {
        const intro = document.getElementById('intro-text');
        intro.style.display = 'flex';
        const txt = "FNAF: NO SAFE PLACE"; let i = 0;
        const int = setInterval(() => {
            intro.innerText += txt[i++];
            if(i >= txt.length) { clearInterval(int); setTimeout(voar, 1000); }
        }, 80);
    }

    function voar() {
        document.getElementById('intro-text').style.opacity = '0';
        new TWEEN.Tween(camera.position).to({ x: 0, y: 15, z: -30 }, 3000)
            .onUpdate(() => camera.lookAt(0, 0, -50))
            .onComplete(() => {
                document.getElementById('fade-overlay').style.opacity = '1';
                setTimeout(initAcordar, 1000);
            }).start();
    }

    function initAcordar() {
        const tela = document.getElementById('tela-acordar');
        tela.style.display = 'flex';
        let c = 0;
        for(let i=0; i<5; i++) {
            const b = document.createElement('button');
            b.className = 'btn-acordar'; b.innerText = 'TAP';
            b.style.left = (Math.random()*60+20)+'%'; b.style.top = (Math.random()*60+20)+'%';
            b.onclick = () => { b.style.display='none'; if(++c === 5) despertar(); };
            tela.appendChild(b);
        }
    }

    function despertar() {
        document.getElementById('tela-acordar').style.display = 'none';
        document.getElementById('fade-overlay').style.opacity = '0';
        camera.position.set(-6, 5, 4);
        luzQuarto.intensity = 20;
        if(dispositivo === 'pc') document.addEventListener('mousedown', () => controls.lock());
    }

    // --- CONTROLES MOBILE (JOYSTICK) ---
    if('ontouchstart' in window) {
        const area = document.getElementById('joystick-area');
        const stick = document.getElementById('joystick-stick');
        area.addEventListener('touchmove', (e) => {
            const touch = e.touches[0];
            const rect = area.getBoundingClientRect();
            const x = touch.clientX - rect.left - 60;
            const y = touch.clientY - rect.top - 60;
            const dist = Math.min(Math.sqrt(x*x + y*y), 40);
            const angle = Math.atan2(y, x);
            stick.style.transform = `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
            moveForward = -Math.sin(angle) * (dist/40);
            moveRight = Math.cos(angle) * (dist/40);
        });
        area.addEventListener('touchend', () => {
            stick.style.transform = `translate(0,0)`;
            moveForward = 0; moveRight = 0;
        });
        // Olhar no mobile (arrastar tela)
        let lastX, lastY;
        window.addEventListener('touchmove', (e) => {
            if(e.target.id === 'joystick-area' || e.target.id === 'joystick-stick') return;
            const t = e.touches[0];
            if(lastX) {
                camera.rotation.y -= (t.clientX - lastX) * 0.005;
                camera.rotation.x -= (t.clientY - lastY) * 0.005;
            }
            lastX = t.clientX; lastY = t.clientY;
        });
        window.addEventListener('touchend', () => { lastX = null; lastY = null; });
    }

    // --- CONTROLES PC ---
    const keys = {};
    document.addEventListener('keydown', (e) => keys[e.code] = true);
    document.addEventListener('keyup', (e) => keys[e.code] = false);

    function animate() {
        requestAnimationFrame(animate);
        TWEEN.update();
        
        const speed = 0.2;
        if(dispositivo === 'pc' && controls.isLocked) {
            if(keys['KeyW']) controls.moveForward(speed);
            if(keys['KeyS']) controls.moveForward(-speed);
            if(keys['KeyA']) controls.moveRight(-speed);
            if(keys['KeyD']) controls.moveRight(speed);
        } else if(dispositivo === 'mobile') {
            camera.translateZ(-moveForward * speed);
            camera.translateX(moveRight * speed);
            camera.position.y = 5; // Manter altura fixa
        }
        
        renderer.render(scene, camera);
    }
    animate();
</script>
</body>
</html>
