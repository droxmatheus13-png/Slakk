<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FNAF: No Safe Place</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; }
        #menu-inicial, #intro-text, #tela-acordar {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100; transition: opacity 1s;
        }
        #menu-inicial { background: radial-gradient(circle, #1a1a1a 0%, #000 100%); }
        h1 { color: #8b0000; font-size: 3.5rem; text-shadow: 0 0 15px #f00; text-align: center; }
        button {
            padding: 15px 40px; font-size: 1.2rem; background: transparent;
            color: white; border: 2px solid #444; cursor: pointer;
            transition: 0.3s; letter-spacing: 3px; margin: 10px;
        }
        button:hover { background: #8b0000; border-color: #f00; box-shadow: 0 0 20px #f00; }
        #tela-acordar { display: none; background: black; z-index: 300; }
        .btn-acordar { position: absolute; border-color: #8b0000; color: #ff0000; font-weight: bold; padding: 10px; cursor: pointer; }
        #fade-overlay { position: absolute; width: 100%; height: 100%; background: black; opacity: 0; pointer-events: none; z-index: 200; }
        #instrucoes { position: absolute; bottom: 20px; width: 100%; text-align: center; color: rgba(255,255,255,0.5); font-size: 0.8rem; pointer-events: none; display: none; z-index: 150; }
    </style>
</head>
<body>

    <div id="fade-overlay"></div>
    <div id="menu-inicial">
        <h1>FNAF:<br>NO SAFE PLACE</h1>
        <button onclick="iniciarJogo()">COMEÇAR JOGO</button>
    </div>
    <div id="intro-text" style="display:none; color:white; font-size:2rem; background:black; padding: 20px; text-align: center;"></div>
    <div id="tela-acordar">
        <h2 style="color: #600; text-shadow: 0 0 10px #000;">DESPERTE</h2>
    </div>
    <div id="instrucoes">WASD PARA ANDAR | MOUSE PARA OLHAR</div>

<script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
            "tween": "https://cdnjs.cloudflare.com/ajax/libs/tween.js/23.1.1/tween.esm.js"
        }
    }
</script>

<script type="module">
    import * as THREE from 'three';
    import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';
    import TWEEN from 'tween';

    // --- AUDIO ---
    const listener = new THREE.AudioListener();
    const alarm = new THREE.Audio(listener);
    const loader = new THREE.AudioLoader();
    loader.load('https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg', (buffer) => {
        alarm.setBuffer(buffer); alarm.setLoop(true); alarm.setVolume(0.2);
    });

    // --- SCENE SETUP ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.add(listener);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new PointerLockControls(camera, document.body);

    // --- MATERIAIS ---
    const matParede = new THREE.MeshStandardMaterial({color: 0x2a1a15, side: THREE.BackSide});
    const matChao = new THREE.MeshStandardMaterial({color: 0x111111});
    const matMadeira = new THREE.MeshStandardMaterial({color: 0x3d2817});

    // --- QUARTO ---
    const quarto = new THREE.Mesh(new THREE.BoxGeometry(30, 15, 30), matParede);
    quarto.position.set(0, 7.5, 0);
    scene.add(quarto);

    // Cama
    const cama = new THREE.Mesh(new THREE.BoxGeometry(10, 3, 16), matMadeira);
    cama.position.set(-8, 1.5, 5);
    scene.add(cama);

    // Porta do Quarto (Saída)
    const portaQuarto = new THREE.Mesh(new THREE.BoxGeometry(6, 11, 0.5), new THREE.MeshStandardMaterial({color: 0x1a0d06}));
    portaQuarto.position.set(5, 5.5, 14.8);
    scene.add(portaQuarto);

    // --- CORREDOR ---
    const corredor = new THREE.Mesh(new THREE.BoxGeometry(12, 15, 80), matParede);
    corredor.position.set(5, 7.5, 55);
    scene.add(corredor);

    const chaoCorredor = new THREE.Mesh(new THREE.PlaneGeometry(12, 80), matChao);
    chaoCorredor.rotation.x = -Math.PI/2;
    chaoCorredor.position.set(5, 0.01, 55);
    scene.add(chaoCorredor);

    // Outras 3 Portas no Corredor
    for(let i=0; i<3; i++) {
        const p = new THREE.Mesh(new THREE.BoxGeometry(0.5, 11, 6), new THREE.MeshStandardMaterial({color: 0x1a0d06}));
        p.position.set(-0.8, 5.5, 40 + (i * 15));
        scene.add(p);
    }

    // --- ESCADA (Atrás da última porta à esquerda) ---
    const escadaGroup = new THREE.Group();
    for(let i=0; i<10; i++) {
        const degrau = new THREE.Mesh(new THREE.BoxGeometry(8, 1, 3), matMadeira);
        degrau.position.set(-8, -i, 70 + (i * 2));
        escadaGroup.add(degrau);
    }
    scene.add(escadaGroup);

    // Luzes
    const luzQuarto = new THREE.PointLight(0xffaa44, 0, 25);
    luzQuarto.position.set(0, 12, 0);
    scene.add(luzQuarto);

    const luzCorredor = new THREE.PointLight(0xffaa44, 0, 30);
    luzCorredor.position.set(5, 12, 50);
    scene.add(luzCorredor);

    scene.add(new THREE.AmbientLight(0xffffff, 0.02));

    // --- CIDADE (CENÁRIO INICIAL) ---
    const cidadeFundo = new THREE.Group();
    for(let i=0; i<50; i++) {
        const h = 20+Math.random()*50;
        const b = new THREE.Mesh(new THREE.BoxGeometry(5,h,5), new THREE.MeshStandardMaterial({color: 0x050510}));
        b.position.set(Math.random()*200-100, h/2, -150);
        cidadeFundo.add(b);
    }
    scene.add(cidadeFundo);

    camera.position.set(0, 100, 100);

    // --- MOVIMENTAÇÃO ---
    const move = { f: false, b: false, l: false, r: false };
    document.addEventListener('keydown', (e) => {
        if(e.code === 'KeyW') move.f = true; if(e.code === 'KeyS') move.b = true;
        if(e.code === 'KeyA') move.l = true; if(e.code === 'KeyD') move.r = true;
    });
    document.addEventListener('keyup', (e) => {
        if(e.code === 'KeyW') move.f = false; if(e.code === 'KeyS') move.b = false;
        if(e.code === 'KeyA') move.l = false; if(e.code === 'KeyD') move.r = false;
    });

    // --- FUNÇÕES DE JOGO ---
    window.iniciarJogo = () => {
        document.getElementById('menu-inicial').style.opacity = '0';
        setTimeout(animarEscrita, 1000);
    };

    function animarEscrita() {
        document.getElementById('menu-inicial').style.display = 'none';
        const intro = document.getElementById('intro-text');
        intro.style.display = 'flex';
        const txt = "FNAF: NO SAFE PLACE"; let i = 0;
        const int = setInterval(() => {
            intro.innerText += txt[i++];
            if(i >= txt.length) { clearInterval(int); setTimeout(voarCamera, 1500); }
        }, 100);
    }

    function voarCamera() {
        document.getElementById('intro-text').style.opacity = '0';
        new TWEEN.Tween(camera.position).to({ x: 0, y: 15, z: -80 }, 4000)
            .easing(TWEEN.Easing.Quadratic.InOut).onUpdate(() => camera.lookAt(0, 0, -150))
            .onComplete(() => {
                document.getElementById('fade-overlay').style.opacity = '1';
                setTimeout(initAcordar, 1000);
            }).start();
    }

    function initAcordar() {
        if(alarm.buffer) alarm.play();
        const tela = document.getElementById('tela-acordar');
        tela.style.display = 'flex';
        let c = 0;
        for(let i=0; i<5; i++) {
            const b = document.createElement('button');
            b.className = 'btn-acordar'; b.innerText = 'ACORDAR';
            b.style.left = (20+Math.random()*60)+'%'; b.style.top = (20+Math.random()*60)+'%';
            b.onclick = () => { b.style.display='none'; if(++c === 5) acordar(); };
            tela.appendChild(b);
        }
    }

    function acordar() {
        alarm.stop();
        document.getElementById('tela-acordar').style.display = 'none';
        document.getElementById('fade-overlay').style.opacity = '0';
        camera.position.set(-8, 5, 5); // Na cama
        luzQuarto.intensity = 15;
        luzCorredor.intensity = 10;
        document.getElementById('instrucoes').style.display = 'block';
        document.addEventListener('click', () => controls.lock());
    }

    function animate() {
        requestAnimationFrame(animate);
        TWEEN.update();
        if(controls.isLocked) {
            const speed = 0.4;
            if(move.f) controls.moveForward(speed);
            if(move.b) controls.moveForward(-speed);
            if(move.l) controls.moveRight(-speed);
            if(move.r) controls.moveRight(speed);
        }
        renderer.render(scene, camera);
    }
    animate();
</script>
</body>
</html>
